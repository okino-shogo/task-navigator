タスクカード長押し（ロングプレス）編集の仕様

用語
	•	タスクカード（タブ）：タイムライン上の長方形のブロック
	•	ハンドル（ちょぼ）：左下＝開始側、右上＝終了側の小さな丸いつまみ
	•	編集モード：ロングプレスで突入する、カードの時間を調整できる状態

⸻

基本フロー
	1.	ロングプレスで編集開始

	•	長押し時間：350–500ms
	•	発火後に軽いハプティック（弱）
	•	視覚効果：カードが1.05倍に拡大、影と輪郭強調、背景は**5–10%**暗転
	•	カード四隅にコーナー半径強調（既存UIに合わせる）

	2.	ハンドルの出現

	•	開始ハンドル：カード左下
	•	終了ハンドル：カード右上
	•	サイズ：直径18–24pt、タップしやすいヒットスロップ+8pt
	•	視覚：実線の縁＋中央に時間方向の矢印アイコン（開始＝▶右、終了＝◀左 など、アプリの表現に合わせる）

	3.	操作モードの自動判定（どこを掴んだかで分岐）

	•	開始調整モード：開始ハンドルをドラッグ → 開始時刻だけが変わる（終了は固定）
	•	終了調整モード：終了ハンドルをドラッグ → 終了時刻だけが変わる（開始は固定）
	•	移動モード：カード本体（ハンドル以外）をドラッグ → カード全体を平行移動（長さは不変）

判定のコツ：指が触れた座標がハンドルのヒット領域内ならそのモード、そうでなければ移動モード。
誤操作防止に**ヒステリシス（6–8pt）**を設け、意図しないモード切替を防ぐ。

	4.	ドラッグ中のフィードバック

	•	時刻スナップ：5分（設定で1/5/10/15分切替可）
	•	スナップ時に微ハプティック
	•	ガイド線：現在の開始/終了位置に細い水平ライン
	•	ツールチップ：カード上部に“10:30–11:45（1h15m）”のように開始・終了・合計時間を常時表示
	•	重なり可視化：他カードと重複したらカード縁を赤、背景を淡い赤に

	5.	編集の確定/キャンセル

	•	指を離す（Touch Up）→確定（強めハプティック）
	•	2本指タップまたは左上×でキャンセル（直前の状態に即時ロールバック）
	•	やり直し/取り消し：1手戻す/進める（Cmd+Z / Cmd+Shift+Z 相当）

⸻

各モードの挙動詳細

A. 開始調整モード（左下ハンドル）
	•	Y方向ドラッグで開始時刻を変更（縦タイムラインの場合）
	•	下方向＝開始を遅らせる、上方向＝早める
	•	最小長：5–10分未満にならない（閾値到達でハンドルにバウンド演出）
	•	終了側は固定。開始が終了を追い越さないようガード

B. 終了調整モード（右上ハンドル）
	•	Y方向ドラッグで終了時刻を変更
	•	上方向＝短縮、下方向＝延長
	•	最小長ガード／最大長（任意。日を跨ぐ場合のルールは下記）

C. 移動モード（カード本体）
	•	Y方向の平行移動で開始・終了が同じだけシフト
	•	カード長は不変
	•	画面上下に近づくとオートスクロール（速度は距離に比例）

⸻

オートスクロール & 日跨ぎ
	•	画面端から24pt以内でオートスクロール開始
	•	スクロール速度：100–600pt/s（端に近いほど速い）
	•	日跨ぎ不許可：端で反発（バウンド）＋バイブ

⸻

スナップ & 制約
	•	既定スナップ：5分
	•	グリッド線がある場合はそのグリッドへ優先スナップ

⸻

視覚デザイン（目安）
	•	ハンドル：直径20pt、セミボールド縁、内側は背景コントラストAA以上
	•	編集中カード：影+24、枠線2pt、彩度+10%
	•	非アクティブ要素：不透明度70%
    競合・重複時のルール
	•	重複許可：そのまま確定可。カードの角に重複バッジ（！）を付与


⸻

パフォーマンス
	•	ドラッグ中はシャドウ/ブラーを簡易表現に落とす（GPU負荷低減）
	•	スナップ計算は1フレーム1回、オーバーラップ判定は近傍のみに限定（空間インデックス）
	•	スクロールは60fps維持

⸻

エッジケース
	•	最小長を下回る：開始/終了のいずれも動かない（ハンドルがぷるっとバウンド）
	•	0時/24時の境界：越境禁止設定なら反発、


⸻

マイクロインタラクション（おすすめ）
	•	編集開始：弱ハプティック + 120msのスケールアップ
	•	スナップ：ごく弱いティック
	•	確定：弱→中の2段バイブ
	•	キャンセル：逆方向の短いバイブ

⸻



機能名

タイムライン空白長押しによる「新規タスクの範囲選択・微調整 → 詳細入力」

ユーザーストーリー
	•	ユーザーはタイムラインの空白を長押しすると、新規タスク作成モードに入る。
	•	長押しを続けたまま指を上下に動かすと、タスクの開始または終了時刻をリアルタイムに調整できる。
	•	どちらを調整するかは「タスク矩形の中心より上＝開始」「中心より下＝終了」で自動判定する。
	•	指を離すと、確定した時間帯で詳細入力画面が開き、タスク名などを入力できる。

⸻

1. ジェスチャーの定義
	•	長押し判定: 500ms前後（端末の触覚フィードバックが心地よい閾値）
	•	ドラッグ判定: 長押し成立後、最小移動距離 2〜6pt程度でドラッグ状態へ
	•	ロングプレス継続中の処理:
	•	最初に触れた位置を初期開始時刻とみなし、仮のタスク矩形（例：30分）を描画
	•	以降、指位置のY座標に応じて開始/終了のどちらかを更新
	•	終了判定: 指を離した時点で現在の時間範囲を確定し、詳細入力画面に遷移

⸻

2. 画面上のフィードバック（必須）
	•	仮タスク矩形: 半透明＋枠線で表示。上端・下端に「つまみ」風の視覚要素があると良い
	•	中央基準線: 薄い水平線（または点線）を矩形中央に表示。
	•	中央より上に指がある間は「開始を調整中」のスタイル（上端の強調・色変更など）
	•	下に指がある間は「終了を調整中」のスタイル（下端の強調）
	•	時刻ラベル: 上端に開始時刻、下端に終了時刻の小さなバッジを常時表示
	•	スナップ時フィードバック: 15分単位などに吸着した瞬間に軽い触覚（または小さな効果音）
	•	重複の警告: 既存イベントに重なったら、矩形を赤みがかった色にし、点線枠や軽い振動で警告

⸻

3. 時刻と座標の関係（実装判断の肝）
	•	タイムラインは縦スクロール前提。
	•	px（pt） → 分の変換比率を固定（例：1pt = 1分。実アプリの見え方に合わせ調整可）。
	•	指の Y座標 → 時刻 は次の順で求める：
	1.	タイムライン先頭時刻（例：06:00）からの経過分＝(Y座標 − タイムライン上端) ÷ 比率
	2.	スナップ（例：15分）に丸める
	3.	範囲クランプ（営業終了や日付境界を超えない）
	•	ドラッグ中は毎フレーム（または一定間隔）で上記変換を行い、表示を更新。

⸻

4. 「中央より上/下」の判定ロジック（概念）
	•	現在の仮タスク矩形の中央Yを常に計算する。
	•	ドラッグ中の指の Y と中央 Y を比較：
	•	指Y < 中央Y → 開始時刻を新しい位置へ
	•	指Y > 中央Y → 終了時刻を新しい位置へ
	•	最小長を確保（例：5分）。開始が終了を超えないようガード。
	•	端を直接つまむ UI（上端/下端の取っ手）も併用可。ただし今回の要件は「中央基準の自動判定」を主とする。

⸻

5. 初期値とスナップ
	•	初期長さ: 30分（プロダクトに合わせて 25/45/60分でも可）
	•	スナップ間隔: 15分（ユーザー設定で 5/10/30 に可変だと良い）
	•	スナップのタイミング: ドラッグ中の都度丸め、離したときも再丸めで確定

⸻

6. 詳細入力画面への遷移
	•	指を離した瞬間にモーダルまたは下からのシートで詳細入力を表示
	•	事前に確定した開始/終了がフィールドに反映済み
	•	入力項目（例）：タスク名、メモ、色（重要度）、通知、カレンダー選択 等
	•	キャンセルした場合は仮タスクを破棄。保存で本登録＋タイムライン反映

⸻

7. バリデーションと重複
	•	重複検査はドラッグ中リアルタイム＆確定時の両方で実施
	•	重複時の選択肢（ダイアログかシート）
	•	重複を許可（上書き/並置）
	•	自動調整（近い空き時間にスライド）
	•	もう一度編集に戻る（作成モード継続）

⸻

8. アクセシビリティ／操作の補助
	•	VoiceOver: 「開始を調整」「終了を調整」のアクションを独立提供
	•	片手操作: 端の握りやすい範囲に補助ハンドルを用意
	•	ガイド: 初回のみ、画面上に「上で開始／下で終了」のチュートリアルチップを表示
	•	触覚:
	•	長押し成立時に軽いフィードバック
	•	スナップごとに微弱フィードバック
	•	重複警告時にやや強め

⸻

9. エッジケース（必ず確認）
	•	タイムラインの上端/下端に近い場所での長押し（矩形が画面外に出ないこと）
	•	最小長未満になろうとしたとき（自動で最小長に戻す）
	•	日付またぎ（終了が翌日にまたがる操作を許可するか、境界でクランプするか）
	•	スクロールと競合（長押し中は親スクロールを抑制。閾値移動でスクロールを解放しない）

⸻

10. 受け入れ基準（QA用）
	1.	空白を500ms前後長押しすると、仮タスク矩形が表示される
	2.	長押しを続けて中央より上でドラッグすると、開始時刻のみが更新される
	3.	中央より下でドラッグすると、終了時刻のみが更新される
	4.	ドラッグ中、開始/終了の時刻ラベルがリアルタイムで更新される
	5.	15分単位で時間が吸着する
	6.	既存イベントと重なった場合、矩形のスタイル変化＋触覚で警告が出る
	7.	指を離すと詳細入力画面が表示され、確定した開始/終了が反映されている
	8.	キャンセルで仮タスクは消え、保存で本タスクがタイムラインに表示される
	9.	最小長（例：5分）を下回る時間帯は確定できない
	10.	上端/下端での操作でもUIが破綻せず、予期せぬスクロールが起きない

⸻

11. 開発メモ（チーム連携のコツ）
	•	「中央基準での上/下判定」がこのUXのコア。
	•	座標→時刻変換・スナップ・クランプをユーティリティ化し、どの画面でも再利用可能に。
	•	既存タスクとの当たり判定は O(n) でも十分だが、将来的に数が増えるならバケットや区間木を検討。